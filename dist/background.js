chrome.runtime.onInstalled.addListener(()=>{console.log("Eden AI Sustainability Counter installed")});chrome.action.onClicked.addListener(async t=>{try{await chrome.sidePanel.open({tabId:t.id})}catch(o){console.error("Error opening side panel:",o),chrome.action.openPopup()}});chrome.runtime.onMessage.addListener((t,o,n)=>{if(t.action==="countTokens")return r(t.text,t.model,t.expectedOutputTokens).then(e=>n({success:!0,data:e})).catch(e=>n({success:!1,error:e.message})),!0;t.action==="openSidebar"&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]&&chrome.sidePanel.open({tabId:e[0].id})})});async function r(t,o="claude-3-5-haiku-20241022",n=200){try{const e=await fetch("https://hackmit2025-pf5p.onrender.com/count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,model:o,expected_output_tokens:n})});if(!e.ok)throw new Error(`API request failed: ${e.status} ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error counting tokens:",e),e}}
